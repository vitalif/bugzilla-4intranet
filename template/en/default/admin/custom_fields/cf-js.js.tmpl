[%# License: Dual-license MPL 1.1+ or GPL 3.0+
  # Author: Vitaliy Filippov <vitalif@mail.ru>
  #%]

[%# FIXME: Move this out from templates into scripts %]

var select_values = new Array();
[% USE Bugzilla %]
[% FOREACH sel_field = Bugzilla.get_fields({ is_select => 1 }) %]
select_values[[% sel_field.id FILTER js %]] = [
  [% FOREACH legal_value = sel_field.legal_values %]
    [[% legal_value.id FILTER js %], '[% legal_value.name FILTER js %]'][% ',' UNLESS loop.last %]
  [% END %]
];
[% END %]

function onChangeType()
{
  var type_field = document.getElementById('type');
  var value_field = document.getElementById('value_field_id');
  if (type_field.value == [% constants.FIELD_TYPE_SINGLE_SELECT %]
      || type_field.value == [% constants.FIELD_TYPE_MULTI_SELECT %])
    value_field.disabled = false;
  else
    value_field.disabled = true;
  var u = document.getElementById('nullable');
  u.disabled = type_field.value != [% constants.FIELD_TYPE_SINGLE_SELECT %];
  if (u.disabled)
    u.checked = false;
  u = type_field.value == [% constants.FIELD_TYPE_EXTURL %];
  document.getElementById('url_title').style.display = u ? '' : 'none';
  document.getElementById('url_field').style.display = u ? '' : 'none';
}

function onChangeVisibilityField()
{
  var vis_field = document.getElementById('visibility_field_id');
  var vis_value = document.getElementById('visibility_value_id');
  var vis_label = document.getElementById('visibility_value_id_label');

  vis_value.style.display = vis_label.style.display = vis_field.value ? '' : 'none';
  if (vis_field.value)
  {
    var values = select_values[vis_field.value];
    bz_populateSelectFromArray(vis_value, values);
  }
  else
  {
    bz_clearOptions(vis_value);
  }
}

function onChangeEnterBug()
{
  var c = document.getElementById('new_bugmail');
  c.disabled = !document.getElementById('enter_bug').checked;
  if (c.disabled)
    c.checked = false;
}
