[%# The contents of this file are subject to the Mozilla Public
  # License Version 1.1 (the "License"); you may not use this file
  # except in compliance with the License. You may obtain a copy of
  # the License at http://www.mozilla.org/MPL/
  #
  # Software distributed under the License is distributed on an "AS
  # IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
  # implied. See the License for the specific language governing
  # rights and limitations under the License.
  #
  # The Original Code is the Bugzilla Bug Tracking System.
  #
  # The Initial Developer of the Original Code is Netscape Communications
  # Corporation. Portions created by Netscape are
  # Copyright (C) 1998 Netscape Communications Corporation. All
  # Rights Reserved.
  #
  # Contributor(s): Andr√© Batosti <batosti@async.com.br>
  #%]

[% PROCESS "global/variables.none.tmpl" %]
From: [% Param('mailfrom') %]
To: [% to %]
Subject: [% (isnew ? '' : 'Re: ') _ '[' _ terms.Bug _ ' ' _ bugid _ '] ' _ (severity == 'blocker' ? '[BLOCKER] ' : '') _ (severity == 'critical' ? '[CRITICAL] ' : '') _ summary %]
X-Bugzilla-Reason: [% reasonsheader %]
X-Bugzilla-Type: [% isnew ? 'new' : 'changed' %]
X-Bugzilla-Watch-Reason: [% reasonswatchheader %]
[% IF Param('useclassification') %]
X-Bugzilla-Classification: [% classification %]
[% END %]
[% IF severity == 'blocker' OR severity == 'critical' %]
Importance: high
X-Priority: 1
[% END %]
X-Bugzilla-Product: [% product %]
X-Bugzilla-Component: [% comp %]
X-Bugzilla-Keywords: [% keywords %]
X-Bugzilla-Severity: [% severity %]
X-Bugzilla-Who: [% changer %]
X-Bugzilla-Status: [% status %]
X-Bugzilla-Priority: [% priority %]
X-Bugzilla-Assigned-To: [% assignedto %]
X-Bugzilla-Target-Milestone: [% targetmilestone %]
X-Bugzilla-Changed-Fields: [% changedfields %]
[%+ threadingmarker %]
[% USE date %]
[% SET boundary = "--" _ date.now %]
Content-Type: multipart/alternative; boundary=[% boundary %]
MIME-Version: 1.0

--[% boundary %]
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

[% FILTER quoted_printable %]
[%+ urlbase %]show_bug.cgi?id=[% bugid %] (prod:[% product %].[% comp %], pri:[% priority %], sev:[% severity %], miles:[% targetmilestone %])

[%+ diffs %]
[% FOREACH comment = new_comments %]

--- Comment #[% comment.count %] from [% comment.author.identity %] [%+ comment.time FILTER time %] ---
[%+ PROCESS bug/format_comment.txt.tmpl comment = comment %]
[% END %]

-- [%# Protect the trailing space of the signature marker %]
Configure [% terms.bug %]mail: [% urlbase %]userprefs.cgi?tab=email
------- You are receiving this mail because: -------
[% FOREACH relationship = reasons %]
  [% SWITCH relationship %]
    [% CASE constants.REL_ASSIGNEE %]
You are the assignee for the [% terms.bug %].
    [% CASE constants.REL_REPORTER %]
You reported the [% terms.bug %].
    [% CASE constants.REL_QA %]
You are the QA contact for the [% terms.bug %].
    [% CASE constants.REL_CC %]
You are on the CC list for the [% terms.bug %]. <a href="[% urlbase %]unsubscribe.cgi?id=[% bugid %]">Remove yourself from the CC list</a>.
    [% CASE constants.REL_VOTER %]
You are a voter for the [% terms.bug %].
    [% CASE constants.REL_GLOBAL_WATCHER %]
You are watching all [% terms.bug %] changes.
  [% END %]
[% END %]
[% FOREACH relationship = reasons_watch %]
  [% SWITCH relationship %]
    [% CASE constants.REL_ASSIGNEE %]
You are watching the assignee of the [% terms.bug %].
    [% CASE constants.REL_REPORTER %]
You are watching the reporter.
    [% CASE constants.REL_QA %]
You are watching the QA contact of the [% terms.bug %].
    [% CASE constants.REL_CC %]
You are watching someone on the CC list of the [% terms.bug %].
    [% CASE constants.REL_VOTER %]
You are watching a voter for the [% terms.bug %].
  [% END %]
[% END %]
[% END %]

--[% boundary %]
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

[% FILTER quoted_printable %]
<style>
<!--
body { font-size: 10pt; }
.difft { font-size: 10pt; border-bottom: 1px solid #808080; padding-bottom: 5pt; }
.difft td { border-bottom: 1px solid #808080; }
.difft tr.n td, .difft.fv td { border-width: 0; border-style: none; }
.difft.fv th { text-align: left; }
/*-->*/
</style>
<body>
[% IF severity == 'blocker' OR severity == 'critical' %]
<p><a style="font-size: 12pt; color: black; background-color: red; font-weight: bold;" href="[%+ urlbase %]show_bug.cgi?id=[% bugid %]">&nbsp;Bug [% bugid %] [[% severity | upper %]] - [% summary | html %]&nbsp;</a></p>
[% ELSE %]
<p><a style="font-size: 12pt;" href="[%+ urlbase %]show_bug.cgi?id=[% bugid %]">Bug [% bugid %] - [% summary | html %]</a></p>
[% END %]
<div style="display: none">(prod:[% product %].[% comp %], pri:[% priority %], sev:[% severity %], miles:[% targetmilestone %])</div>

[% IF new_comments AND new_comments.size > 0 %]
  [% FOR comment = new_comments %]
  <p><a href="[%+ urlbase %]show_bug.cgi?id=[% bugid %]#c[% comment.count %]">Comment #[% comment.count %]</a> from
      <span class="vcard">
          <a class="fn email" href="[% Param('user_mailto') %][% comment.author.email FILTER html %]">
          [% (comment.author.name || comment.author.login) FILTER html %]</a>
      </span>
  [% comment.time %]</p>
  [% IF comment.already_wrapped %]
    [% wrapped_comment = comment.body %]
  [% ELSE %]
    [% wrapped_comment = comment.body FILTER wrap_comment %]
  [% END %]
  <pre style="border-width: 0 0 1px 0; border-style: solid; border-color: #808080; white-space: pre-wrap; word-wrap: break-word; _white-space: pre;">
[%- wrapped_comment FILTER quoteUrls(bugid) FILTER absolute_uris -%]
  </pre>
  [% END %]
[% END %]

[% IF isnew AND showfieldvalues.size > 0 %]
<table class="difft fv">
[% FOR f = showfieldvalues %]
  <tr><th>[% f.desc FILTER html %]:</th><td>[% f.value FILTER html %]</td></tr>
[% END %]
</table>
[% END %]

[% IF diffarray AND diffarray.size > 0 %]
<table class="difft" width="600px" style="border-collapse: collapse" cellpadding="3">
[% FOR adiff = diffarray %]
  [% SWITCH adiff.type %]
    [% CASE "change" %]
    <tr class="n"><td>[% adiff.what %]</td><td>[% adiff.old %]</td><td>[% adiff.new %]</td></tr>
    [% CASE "who" %]
    <tr><td colspan="3">
        <a href="[% Param('user_mailto') %][% adiff.who %]">[% IF adiff.name %][% adiff.name %][% ELSE %][% adiff.who %][% END %]</a>
        changed:
    </td></tr>
    <tr><th style="text-align: left">What</th><th style="text-align: left">Removed</th><th style="text-align: left">Added</th></tr>
    [% CASE "dep" %]
    <tr><td colspan="3">
        <p><a href="[% urlbase %]show_bug.cgi?id=[% adiff.id %]">Bug [% adiff.id %]</a> depends
        on <a href="[% urlbase %]show_bug.cgi?id=[% adiff.dep %]">bug [% adiff.dep %]</a>,
        which changed state.</p>
        <p><a href="[% urlbase %]show_bug.cgi?id=[% adiff.dep %]">Bug [% adiff.dep %]</a>
        summary: [% adiff.summary %].
    </td></tr>
  [% END %]
[% END %]
</table>
[% END %]

<p style="font-size: 12px; font-style: italic">
-- <br />
<a href="[% urlbase %]userprefs.cgi?tab=email">Configure [% terms.bug %]mail</a><br />
------- You are receiving this mail because: -------<br />
[% FOREACH relationship = reasons %]
  [% SWITCH relationship %]
    [% CASE constants.REL_ASSIGNEE %]
You are the assignee for the [% terms.bug %].
    [% CASE constants.REL_REPORTER %]
You reported the [% terms.bug %].
    [% CASE constants.REL_QA %]
You are the QA contact for the [% terms.bug %].
    [% CASE constants.REL_CC %]
You are on the CC list for the [% terms.bug %]. <a href="[% urlbase %]unsubscribe.cgi?id=[% bugid %]">Remove yourself from the CC list</a>.
    [% CASE constants.REL_VOTER %]
You are a voter for the [% terms.bug %].
    [% CASE constants.REL_GLOBAL_WATCHER %]
You are watching all [% terms.bug %] changes.
  [% END %]
[% END %]
[% FOREACH relationship = reasons_watch %]
  [% SWITCH relationship %]
    [% CASE constants.REL_ASSIGNEE %]
      <br />You are watching the assignee of the [% terms.bug %].
    [% CASE constants.REL_REPORTER %]
      <br />You are watching the reporter.
    [% CASE constants.REL_QA %]
      <br />You are watching the QA contact of the [% terms.bug %].
    [% CASE constants.REL_CC %]
      <br />You are watching someone on the CC list of the [% terms.bug %].
    [% CASE constants.REL_VOTER %]
      <br />You are watching a voter for the [% terms.bug %].
  [% END %]
[% END %]
</p>
</body>
[% END %]
--[% boundary %]--
