[%# This Source Code Form is subject to the terms of the Mozilla Public
  # License, v. 2.0. If a copy of the MPL was not distributed with this
  # file, You can obtain one at http://mozilla.org/MPL/2.0/.
  #
  # This Source Code Form is "Incompatible With Secondary Licenses", as
  # defined by the Mozilla Public License, v. 2.0.
  #%]

[%# INTERFACE:
  # bug.bug_id: integer. Number of current bug (for navigation purposes)
  #%]

[% USE Bugzilla %]
[% cgi = Bugzilla.cgi %]

[% IF NOT (cgi.user_agent("MSIE [1-6]") OR cgi.user_agent("Mozilla/4")) %]
  <link rel="Top" href="[% urlbase FILTER html %]">

  [%# *** Attachment *** %]
  [% IF attachment && attachment.bug_id %]
    <link rel="Up" href="show_bug.cgi?id=[% attachment.bug_id FILTER none %]">
  [% END %]


  [%# *** Dependencies, Activity, Print-version *** %]
  [% IF bug %]
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=[% bug.bug_id %]&amp;hide_resolved=1">
    [% IF Param('webdotbase') %]
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=[% bug.bug_id %]">
    [% END %]

      <link rel="Show" title="[% terms.Bug %] Activity"
            href="show_activity.cgi?id=[% bug.bug_id %]">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=[% bug.bug_id %]">
  [% END %]


  [%# *** Saved Searches *** %]
  [% IF user.showmybugslink %]
    [% user_login = user.login FILTER uri %]
    <link rel="Saved&nbsp;Searches" title="My [% terms.Bugs %]"
          href="[% Param('mybugstemplate').replace('%userid%', user_login) %]">
  [% END %]

  [% FOREACH q = user.queries %]
    <link rel="Saved&nbsp;Searches" 
          title="[% q.name FILTER html %]"
          href="buglist.cgi?cmdtype=runnamed&amp;namedcmd=[% q.name FILTER url_quote %]">
  [% END %]

  [% FOREACH q = user.queries_subscribed %]
    <link rel="Saved&nbsp;Search"
          title="[% q.name FILTER html %] ([% q.user.login FILTER html %])"
          href="buglist.cgi?cmdtype=dorem&amp;remaction=run&amp;namedcmd=
                 [% q.name FILTER uri %]&amp;sharer_id=
                 [% q.user.id FILTER uri %]">
  [% END %]

  [%# *** Bugzilla Administration Tools *** %]
  [% IF user.login %] 
    [% '<link rel="Administration" title="Parameters"   href="editparams.cgi">'    IF user.in_group('tweakparams') %]
    [% '<link rel="Administration" title="Users"        href="editusers.cgi">'     IF user.in_group('editusers') %]
    [%# TODO this is probably slow for non-admins... %]
    [% '<link rel="Administration" title="Products"     href="editproducts.cgi">'  IF user.in_group('editcomponents') || user.get_editable_products.size %]
    [% '<link rel="Administration" title="Flag Types"   href="editflagtypes.cgi">' IF user.in_group('editcomponents') %]
    [% '<link rel="Administration" title="Groups"       href="editgroups.cgi">'    IF user.in_group('creategroups') %]
    [% '<link rel="Administration" title="Keywords"     href="editkeywords.cgi">'  IF user.in_group('editkeywords') %]
    [% '<link rel="Administration" title="Whining"      href="editwhines.cgi">'    IF user.in_group('bz_canusewhines') %]
    [% '<link rel="Administration" title="Sanity Check" href="sanitycheck.cgi">'   IF user.in_group('editcomponents') %]
  [% END %]  
[% END %]
